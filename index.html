<!DOCTYPE html>
<html lang="en">
<head>

	<!-- Begin: Basic Meta Tags -->
	<meta charset="UTF-8" /> <!-- Set character encoding -->
	<meta http-equiv="X-UA-Compatible" content="IE=Edge" /> <!-- Internet Explorer compatibility mode -->
	<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1" /> <!-- For responsiveness on mobile browsers -->
	<!-- End: Basic Meta Tags -->

	<!-- Begin: Content Security Policy Meta Tags -->
	<!--<meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-eval' data: blob: filesystem: ws: gap: cdvfile: https://ssl.gstatic.com *; style-src * 'unsafe-inline'; script-src * 'unsafe-inline' 'unsafe-eval'; img-src * data: 'unsafe-inline'; connect-src * 'unsafe-inline'; child-src *;" /> <!-- Allows control over where the resources are loaded from -->
	<!-- End: Content Security Policy Meta Tags -->

	<!-- Begin: Android Meta Tags -->
	<meta name="mobile-web-app-capable" content="yes" />
	<meta name="theme-color" content="#235694" /> <!-- Status bar color -->

	<link rel="icon" type="image/png" sizes="192x192" href="assets/custom/favicons/192.png" />
	<link rel="manifest" href="manifest.json" />
	<!-- End: Android Meta Tags -->

	<!-- Begin: iOS Meta Tags -->
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
	<meta name="format-detection" content="telephone=no" /> <!-- Disable automatic detection and formatting of possible phone numbers -->
	<meta name="apple-mobile-web-app-title" content="TEC InternApp" />

	<link rel="apple-touch-icon" sizes="36x36" href="assets/custom/favicons/36.png" />
	<link rel="apple-touch-icon" sizes="48x48" href="assets/custom/favicons/48.png" />
	<link rel="apple-touch-icon" sizes="72x72" href="assets/custom/favicons/72.png" />
	<link rel="apple-touch-icon" sizes="96x96" href="assets/custom/favicons/96.png" />
	<link rel="apple-touch-icon" sizes="144x144" href="assets/custom/favicons/144.png" />
	<link rel="apple-touch-icon" sizes="192x192" href="assets/custom/favicons/192.png" />
	<link rel="apple-touch-icon" sizes="256x256" href="assets/custom/favicons/256.png" />
	<link rel="apple-touch-icon" sizes="384x384" href="assets/custom/favicons/384.png" />
	<link rel="apple-touch-icon" sizes="512x512" href="assets/custom/favicons/512.png" />
	<!-- End: iOS Meta Tags -->

	<!-- Begin: Favicons -->
	<link rel="icon" type="image/png" sizes="36x36" href="assets/custom/favicons/36.png"/>
	<link rel="shortcut icon" href="assets/custom/favicons/36.png" />
	<!-- End: Favicons -->

	<!-- Begin: Stylesheets -->
	<link rel="stylesheet" href="assets/vendor/framework7/css/framework7.material.min.css" />
	<link rel="stylesheet" href="assets/vendor/framework7/css/framework7.material.colors.min.css" />
	<link rel="stylesheet" href="assets/vendor/framework7-plugins/keypad/framework7.keypad.min.css" />
	<link rel="stylesheet" href="assets/vendor/framework7-plugins/indexed-list/framework7.indexed-list.min.css" />
	<link rel="stylesheet" href="assets/vendor/framework7-plugins/toast/toast.css" />
	<link rel="stylesheet" href="assets/vendor/framework7-plugins/tour-guide/tour-guide.css" />
	<link rel="stylesheet" href="assets/vendor/font-awesome/css/fontawesome-all.min.css" />
	<link rel="stylesheet" href="assets/vendor/hamburgers/hamburgers.min.css" />
	<link rel="stylesheet" href="assets/vendor/material-icons/material-icons.css" />
	<link rel="stylesheet" href="assets/vendor/pattern-lock/patternLock.css" />
	<link rel="stylesheet" href="assets/vendor/rateyo/jquery.rateyo.min.css" />
	<link rel="stylesheet" href="assets/vendor/tooltipster/css/tooltipster.bundle.min.css" />
	<link rel="stylesheet" href="assets/vendor/tooltipster/css/plugins/tooltipster/sideTip/themes/tooltipster-sideTip-borderless.min.css" />

	<link rel="stylesheet" href="assets/vendor/nectar/nectar.css" />

	<link rel="stylesheet" href="assets/custom/css/components.css" />
	<link rel="stylesheet" href="assets/custom/css/pages.css" />
	<!-- End: Stylesheets -->

	<title>TEC InternApp</title>
</head>

<body class="theme-blue">
<div class="statusbar-overlay"></div>
<div class="panel-overlay"></div>

<div class="views">
	<div class="view view-main">
		<div class="pages navbar-fixed">
			<div data-page="splash-screen" class="page no-navbar">
				<!-- Begin: Page Content -->
				<div class="page-content">
					<!--<div class="splash">
						<div class="splash-media">
							<img src="assets/custom/img/tia-logo.svg" width="100%" />
						</div>
						<div class="splash-preloader">
							<span class="preloader preloader-blue"></span>
						</div>
					</div>-->
				</div>
				<!-- End: Page Content -->
			</div>
		</div>
	</div>
</div>

<!-- Begin: Scripts -->
<script type="text/javascript" src="assets/vendor/jquery/jquery-2.2.4.min.js"></script>
<script type="text/javascript" src="assets/vendor/framework7/js/framework7.min.js"></script>
<script type="text/javascript" src="assets/vendor/framework7-plugins/keypad/framework7.keypad.min.js"></script>
<script type="text/javascript" src="assets/vendor/framework7-plugins/indexed-list/framework7.indexed-list.min.js"></script>
<script type="text/javascript" src="assets/vendor/framework7-plugins/toast/toast.js"></script>
<script type="text/javascript" src="assets/vendor/framework7-plugins/tour-guide/tour-guide.js"></script>
<script type="text/javascript" src="assets/vendor/jquery-validation/jquery.validate.min.js"></script>
<script type="text/javascript" src="assets/vendor/jquery-validation/additional-methods.min.js"></script>
<script type="text/javascript" src="assets/vendor/pattern-lock/patternLock.min.js"></script>
<script type="text/javascript" src="assets/vendor/rateyo/jquery.rateyo.min.js"></script>
<script type="text/javascript" src="assets/vendor/tooltipster/js/tooltipster.bundle.min.js"></script>
<script type="text/javascript" src="assets/vendor/vivus/vivus.min.js"></script>
<script type="text/javascript" src="assets/vendor/geocomplete/jquery.geocomplete.min.js"></script>

<script type="text/javascript" src="assets/custom/js/init.js"></script>

<script type="text/javascript" src="assets/vendor/nectar/nectar.js"></script>

<script type="text/javascript" src="assets/custom/js/components.js"></script>
<script type="text/javascript" src="assets/custom/js/pages.js"></script>
<script type="text/javascript" src="assets/custom/js/themes.js"></script>
<script type="text/javascript" src="assets/custom/js/localforage.min.js"></script>

<script type="text/javascript" src="assets/vendor/qrc/grid.js"></script>
<script type="text/javascript" src="assets/vendor/qrc/version.js"></script>
<script type="text/javascript" src="assets/vendor/qrc/detector.js"></script>
<script type="text/javascript" src="assets/vendor/qrc/formatinf.js"></script>
<script type="text/javascript" src="assets/vendor/qrc/errorlevel.js"></script>
<script type="text/javascript" src="assets/vendor/qrc/bitmat.js"></script>
<script type="text/javascript" src="assets/vendor/qrc/datablock.js"></script>
<script type="text/javascript" src="assets/vendor/qrc/bmparser.js"></script>
<script type="text/javascript" src="assets/vendor/qrc/datamask.js"></script>
<script type="text/javascript" src="assets/vendor/qrc/rsdecoder.js"></script>
<script type="text/javascript" src="assets/vendor/qrc/gf256poly.js"></script>
<script type="text/javascript" src="assets/vendor/qrc/gf256.js"></script>
<script type="text/javascript" src="assets/vendor/qrc/decoder.js"></script>
<script type="text/javascript" src="assets/vendor/qrc/qrcode.js"></script>
<script type="text/javascript" src="assets/vendor/qrc/findpat.js"></script>
<script type="text/javascript" src="assets/vendor/qrc/alignpat.js"></script>
<script type="text/javascript" src="assets/vendor/qrc/databr.js"></script>
<script type="text/javascript" src="assets/custom/js/vcard.js"></script>

<script type="text/javascript" src="assets/custom/js/formdata.min.js"></script>
<script type="text/javascript" src="assets/custom/js/canvas-to-blob.min.js"></script>
<script type="text/javascript" src="assets/custom/js/instascan.min.js"></script>
<script type="text/javascript" src="assets/custom/js/DetectRTC.min.js"></script>

<script type="text/javascript" src="assets/custom/js/canvas.js"></script>
<script type="text/javascript" src="assets/custom/js/downsample.js"></script>
<script type="text/javascript" src="assets/custom/js/downscale.js"></script>


<script type="text/javascript">
    'use strict';

    (function() {
        myApp.init();
        if('serviceWorker' in navigator) {
            navigator.serviceWorker
                .register('sw.js')
                .then(function() { console.log("Service Worker Registered"); });
        }


        // Load relations
        function getRelations(token) {
            console.log("Retrieving list of Relations...");
            $.ajax({
                url: SERVER_URL+"/api/relations/get",
                method: 'GET',
                cache: false,
                async: true,
                headers: {'Authorization': 'Bearer ' + token},
                error: function(status, xhr) {
                    alert("Get relations failed: " + status);
                },
                success: function(data, status, xhr) {
                    console.log("Relations list retrieved.");
                    parseRelations(data).then(function(relations) {
                        localforage.setItem('relasi', /*JSON.stringify*/(relations)).then(function(value) {
                            console.log("Relations added");
                        }).catch(function(err) {
                            console.log(err);
                        });
                    }).catch(function(err) {
                        console.log(err);
                    });
                }
            });
        }

        /**
         * Parses array of Relations
         * @param arr array of Relations
         * @returns {Promise<Array>}
         */
        async function parseRelations(arr) {
            let relations = {};
            for(let i=0; i < arr.length; i++) {
                let card = vCard.parse(arr[i].vcard);
                card.relationId = "id-" + arr[i].id;
                relations[card.relationId] = card;
            }

            return relations;
        }

        // Check if user is logged in
        localforage.getItem("token").then(function (readValue) {
            if (readValue != null) {
                getRelations(readValue);
            }
        });
    })();
</script>
<!-- End: Scripts -->

</body>
</html>
